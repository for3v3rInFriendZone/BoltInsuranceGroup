/**
 * angular-fancy-modal - the definitive modal/popup/dialog solution for AngularJS.
 * @author Alessandro Arnodo
 * @url http://alessandro.arnodo.net
 * @version v0.1.4
 * @link https://github.com/vesparny/angular-fancy-modal
 * @license MIT
 */
!function(e,n,o,a){"use strict";e.module("vesparny.fancyModal",[]).provider("$fancyModal",function(){var o=this.defaults={templateUrl:"",template:"<div></div>",resolve:{},controller:"",scope:"",showCloseButton:!0,closeOnEscape:!0,closeOnOverlayClick:!0,overlay:!0,themeClass:"",openingClass:"fancymodal-content-opening",closingClass:"fancymodal-content-closing",openingOverlayClass:"fancymodal-overlay-opening",closingOverlayClass:"fancymodal-overlay-closing",bodyClass:"fancymodal-open"};this.setDefaults=function(n){e.extend(this.defaults,n)},this.$get=["$controller","$timeout","$rootScope","$injector","$compile","$http","$templateCache","$window","$document","$q",function(a,t,l,i,s,r,d,c,f,m){function u(e){27===e.keyCode&&k()}function v(){var e=n.createElement("div");e.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",n.body.appendChild(e);var o=e.offsetWidth-e.clientWidth;return n.body.removeChild(e),o}function p(){return x[0].scrollHeight>c.innerHeight}function y(e){var n=m.defer();return e.templateUrl?r.get(e.templateUrl,{cache:d}).then(function(e){n.resolve(e.data)}):n.resolve(e.template),n.promise}function h(n){var o=[];return e.forEach(n,function(e){o.push(m.when(i.invoke(e)))}),o}function C(e){var n=e.attr("id");e.scope().$destroy(),e.remove(),O=!1,0===w&&(x.removeClass("fancymodal-open"),j.css("margin-right","")),l.$emit("$fancyModal.closed",n)}function g(n){var o=e.element(n),a=o.data("options");if(O=!0,o.unbind("click"),1===w&&f.unbind("keydown"),w-=1,D){var t=e.element(n.children[0]);if(a.overlay){var l=e.element(n.children[0]);l.addClass(a.closingOverlayClass),t=e.element(n.children[1])}t.unbind(M).bind(M,function(){t.remove(),C(o)}).removeClass(a.openingClass).addClass(a.closingClass)}else C(o)}function $(){var o=n.querySelectorAll(".fancymodal");e.forEach(o,function(e){g(e)})}function b(n){function t(n){var o=e.element(n.target).hasClass("fancymodal-overlay"),a=e.element(n.target).hasClass("fancymodal-close");(o&&r.closeOnOverlayClick||a)&&k(c.attr("id"))}function i(n){var o,t=m.defer();return y(r).then(function(e){return o=e,m.all(h(r.resolve))}).then(function(i){if(O)t.reject();else{var f,m={},u=0;e.forEach(r.resolve,function(e,n){m[n]=i[u],u+=1}),d.$modal=n,m.$scope=d,r.controller&&(f=a(r.controller,m)),$.append(s(o)(d)),l.$emit("$fancyModal.opened",c),t.resolve()}}),t.promise}var r=e.copy(o);n=n||{},e.extend(r,n),w+=1,E+=1,x.addClass(r.bodyClass),p()&&j.css("margin-right",v()+"px");var d=(r.scope||l).$new(),c=e.element('<div id="fancymodal-'+E+'" class="fancymodal"></div>').addClass(r.themeClass);c.data("options",r);var C=e.element("<div>").addClass("fancymodal-content");if(r.showCloseButton){var g=e.element("<div>").addClass("fancymodal-close");C.append(g)}r.closeOnEscape&&f.bind("keydown",u);var $=e.element("<div>").addClass("fancymodal-data");if(r.overlay){var b=e.element("<div>").addClass("fancymodal-overlay").addClass(r.openingOverlayClass);c.append(b)}C.append($),C.addClass(r.openingClass),c.bind("click",t),c.append(C),x.append(s(c)(d));var A="fancymodal-"+E,D={id:A,close:function(){return k(A)}},M=i(D);return e.extend({opened:M},D)}function k(e){var o=n.getElementById(e);o?g(o):$()}var w=0,E=0,O=!1,A=(n.body||n.documentElement).style,D=e.isDefined(A.animation)||e.isDefined(A.WebkitAnimation)||e.isDefined(A.MozAnimation)||e.isDefined(A.MsAnimation)||e.isDefined(A.OAnimation),M="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",x=e.element(n).find("body"),j=e.element(n).find("html");return{open:function(e){return b(e)},close:function(e){return k(e)},getDefaults:function(){return e.copy(o)}}}]}).directive("fancyModal",["$fancyModal",function(n){return{restrict:"A",link:function(o,a,t){var l,i;a.on(t.trigger||"click",function(){i=n.getDefaults(),e.forEach(Object.keys(i),function(n){e.isDefined(t[n])&&(i[n]="true"===t[n]?!0:"false"===t[n]?!1:t[n])}),l=n.open(i)}),o.$on("$destroy",function(){l?l.opened.then(function(){l.close(),l=null}):l=null,i=null})}}}])}(angular,document,window);